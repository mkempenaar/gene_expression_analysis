<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Analysis of Gene Expression</title>
  <meta name="description" content="Course Syllabus for the Theme 7 course">
  <meta name="generator" content="bookdown 0.5.16 and GitBook 2.6.7">

  <meta property="og:title" content="Analysis of Gene Expression" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Course Syllabus for the Theme 7 course" />
  <meta name="github-repo" content="mkempenaar/BFVH15CAPSTONE" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Analysis of Gene Expression" />
  
  <meta name="twitter:description" content="Course Syllabus for the Theme 7 course" />
  

<meta name="author" content="Marcel Kempenaar">


<meta name="date" content="2018-03-07">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="chapter-3.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Theme 07 - Analysis of Gene Expression</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="chapter-1.html"><a href="chapter-1.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="chapter-1.html"><a href="chapter-1.html#theme-7---analysis-of-gene-expression-project"><i class="fa fa-check"></i><b>1.1</b> Theme 7 - Analysis of Gene Expression Project</a></li>
<li class="chapter" data-level="1.2" data-path="chapter-1.html"><a href="chapter-1.html#project-deliverables"><i class="fa fa-check"></i><b>1.2</b> Project Deliverables</a></li>
<li class="chapter" data-level="1.3" data-path="chapter-1.html"><a href="chapter-1.html#project-schedule"><i class="fa fa-check"></i><b>1.3</b> Project Schedule</a></li>
<li class="chapter" data-level="1.4" data-path="chapter-1.html"><a href="chapter-1.html#grading"><i class="fa fa-check"></i><b>1.4</b> Grading</a></li>
<li class="chapter" data-level="1.5" data-path="chapter-1.html"><a href="chapter-1.html#project-proposal"><i class="fa fa-check"></i><b>1.5</b> Project Proposal</a></li>
<li class="chapter" data-level="1.6" data-path="chapter-1.html"><a href="chapter-1.html#lab-journal"><i class="fa fa-check"></i><b>1.6</b> <em>Lab Journal</em></a></li>
<li class="chapter" data-level="1.7" data-path="chapter-1.html"><a href="chapter-1.html#article"><i class="fa fa-check"></i><b>1.7</b> Article</a><ul>
<li class="chapter" data-level="1.7.1" data-path="chapter-1.html"><a href="chapter-1.html#installing-the-article-template"><i class="fa fa-check"></i><b>1.7.1</b> Installing the Article Template</a></li>
<li class="chapter" data-level="1.7.2" data-path="chapter-1.html"><a href="chapter-1.html#using-the-template"><i class="fa fa-check"></i><b>1.7.2</b> Using the Template</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="chapter-2.html"><a href="chapter-2.html"><i class="fa fa-check"></i><b>2</b> Discovering Data Sets</a><ul>
<li class="chapter" data-level="2.1" data-path="chapter-2.html"><a href="chapter-2.html#finding-public-data"><i class="fa fa-check"></i><b>2.1</b> Finding Public Data Sets of Interest</a></li>
<li class="chapter" data-level="2.2" data-path="chapter-2.html"><a href="chapter-2.html#ncbi-geo"><i class="fa fa-check"></i><b>2.2</b> The NCBI <em>Gene Expression Omnibus</em></a></li>
<li class="chapter" data-level="2.3" data-path="chapter-2.html"><a href="chapter-2.html#project-proposal_ch2"><i class="fa fa-check"></i><b>2.3</b> Creating a Project Proposal</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="chapter-3.html"><a href="chapter-3.html"><i class="fa fa-check"></i><b>3</b> Exploratory Data Analysis</a><ul>
<li class="chapter" data-level="3.1" data-path="chapter-3.html"><a href="chapter-3.html#expl-data"><i class="fa fa-check"></i><b>3.1</b> Exploring the Available Project Data</a></li>
<li class="chapter" data-level="3.2" data-path="chapter-3.html"><a href="chapter-3.html#loading-data"><i class="fa fa-check"></i><b>3.2</b> Loading data into R</a></li>
</ul></li>
<li class="part"><span><b>I <em>EDA</em> Part 1</b></span><ul>
<li class="chapter" data-level="3.3" data-path="chapters/04-deg.html"><a href="#EDA_part1"><i class="fa fa-check"></i><b>3.3</b> Visualizing using <code>summary</code>, <code>boxplot</code>, <code>scatterplot</code> &amp; <code>MA-plot</code></a><ul>
<li class="chapter" data-level="3.3.1" data-path="chapter-3.html"><a href="chapter-3.html#eda_statistics"><i class="fa fa-check"></i><b>3.3.1</b> Statistics</a></li>
<li class="chapter" data-level="3.3.2" data-path="chapter-3.html"><a href="chapter-3.html#eda_boxplots"><i class="fa fa-check"></i><b>3.3.2</b> Boxplots</a></li>
<li class="chapter" data-level="3.3.3" data-path="chapter-3.html"><a href="chapter-3.html#eda_scatter_plot"><i class="fa fa-check"></i><b>3.3.3</b> Scatterplots</a></li>
<li class="chapter" data-level="3.3.4" data-path="chapter-3.html"><a href="chapter-3.html#MA_plot"><i class="fa fa-check"></i><b>3.3.4</b> MA-plot</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II <em>EDA</em> Part 2</b></span><ul>
<li class="chapter" data-level="3.4" data-path="chapters/04-deg.html"><a href="#EDA_part2"><i class="fa fa-check"></i><b>3.4</b> Visualizing using <code>heatmap</code>, <code>MDS</code> &amp; <code>PCA</code></a><ul>
<li class="chapter" data-level="3.4.1" data-path="chapter-3.html"><a href="chapter-3.html#normalization"><i class="fa fa-check"></i><b>3.4.1</b> Normalization</a></li>
<li class="chapter" data-level="3.4.2" data-path="chapter-3.html"><a href="chapter-3.html#eda_distance"><i class="fa fa-check"></i><b>3.4.2</b> Distance Calculation</a></li>
<li class="chapter" data-level="3.4.3" data-path="chapter-3.html"><a href="chapter-3.html#eda_heatmap"><i class="fa fa-check"></i><b>3.4.3</b> Sample Distances using a Heatmap</a></li>
<li class="chapter" data-level="3.4.4" data-path="chapter-3.html"><a href="chapter-3.html#eda_mds"><i class="fa fa-check"></i><b>3.4.4</b> Sample Distances using MDS</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="chapter-4.html"><a href="chapter-4.html"><i class="fa fa-check"></i><b>4</b> Discovering Differentialy Expressed Genes (DEGs)</a><ul>
<li class="chapter" data-level="4.1" data-path="chapter-4.html"><a href="chapter-4.html#deg-preprocessing"><i class="fa fa-check"></i><b>4.1</b> Pre-processing</a></li>
<li class="chapter" data-level="4.2" data-path="chapter-4.html"><a href="chapter-4.html#deg-fc"><i class="fa fa-check"></i><b>4.2</b> The <em>Fold Change</em> Value</a></li>
<li class="chapter" data-level="4.3" data-path="chapter-4.html"><a href="chapter-4.html#deg-manual"><i class="fa fa-check"></i><b>4.3</b> Using Manual Methods (<code>t-test</code> &amp; <code>ANOVA</code>)</a><ul>
<li class="chapter" data-level="4.3.1" data-path="chapter-4.html"><a href="chapter-4.html#deg-ttest"><i class="fa fa-check"></i><b>4.3.1</b> Students T-test</a></li>
<li class="chapter" data-level="4.3.2" data-path="chapter-4.html"><a href="chapter-4.html#deg-anova"><i class="fa fa-check"></i><b>4.3.2</b> Analysis of Variance (<code>ANOVA</code>)</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="chapter-4.html"><a href="chapter-4.html#deg-mtc"><i class="fa fa-check"></i><b>4.4</b> Multiple Testing Correction</a></li>
<li class="chapter" data-level="4.5" data-path="chapter-4.html"><a href="chapter-4.html#deg-bioconductor"><i class="fa fa-check"></i><b>4.5</b> Using Bioconductor</a><ul>
<li class="chapter" data-level="4.5.1" data-path="chapter-4.html"><a href="chapter-4.html#deg-design"><i class="fa fa-check"></i><b>4.5.1</b> The <code>Design</code> (matrix)</a></li>
<li class="chapter" data-level="4.5.2" data-path="chapter-4.html"><a href="chapter-4.html#deg-deseq2"><i class="fa fa-check"></i><b>4.5.2</b> <code>DESeq2</code></a></li>
<li class="chapter" data-level="4.5.3" data-path="chapter-4.html"><a href="chapter-4.html#deg-edger"><i class="fa fa-check"></i><b>4.5.3</b> <code>edgeR</code></a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Analysis of Gene Expression</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chapter-4" class="section level1">
<h1><span class="header-section-number"></span> Discovering Differentialy Expressed Genes (DEGs)</h1>
<p>The first ‘real’ analysis step we will do is finding genes that show a difference in expression between sample groups; the <em>differentially expressed genes</em>. The concept might sound rather simple; calculate the ratios for all genes between samples to determine the <strong>fold-change</strong> (FC) denoting the factor of change in expression between groups. Then, filter out only those genes that actually show a difference. While this does give a list of genes showing different behaviour across samples, we need to focus on genes that do not only show a difference, but are also <em>statistically significant</em>!</p>
<p>To determine whether or not a gene can be classified as a significant DEG we are going to use - at least - two techniques:</p>
<ul>
<li>We will start with manually performing statistical test(s)</li>
<li>and compare these results from those given by using one or more Bioconductor libraries (mostly <code>edgeR</code> and <code>DeSEQ2</code>)</li>
</ul>
<div id="deg-preprocessing" class="section level2">
<h2><span class="header-section-number">4.1</span> Pre-processing</h2>
<p>Given the results of the exploratory data analysis performed in <a href="chapter-3.html#chapter-3">chapter 3</a>, you might have concluded that there are one or more samples that show (very) deviating expression patterns compared to samples from the same group. <em>If</em> you have more then enough (&gt; 3) samples in a group, you might opt to remove a sample to reduce the noise, as the statistical tests are very sensitive to this. Since we are performing all analysis steps programatically it is also very easy to test for DEGs with and without the sample(s) in question and see if the removal results in lower p-values (= higher significance). If this is the case you can continue on without those sample(s). As always, be sure to properly document this, including the reason why you chose to remove them.</p>
<p>Another step we need to take - and this might be guided by your article - is to filter out (partially) inactive genes. Most datasets available contains a lot of 0-measurements, transcripts where no reads have mapped. In an experiment with two groups, three replicates each, if three out of those six samples have 0-reads mapped, it is often adviced to remove the gene completely. But this can be very subjective to the experiment, it might be expected (thus important) when comparing different tissues or knockout experiments. Also, genes with a (very) low read count can give a very high (artificial) FC value (see the lefthand side of an MA-plot). Comparing two samples where one has a value of 2 and the other 11, this reads as an up-regulated gene by a factor of <em>5.5</em> while it might actually just be <em>noise</em>!</p>
<ul>
<li><strong>Assignment</strong>: Search through your article for any advice on how to filter out zero values or low count genes. If there is nothing stated on this subject, think of your own tactic (or search the literature/ online!). It is perfectly fine to discuss with your peers.
<ul>
<li><strong>describe</strong> what you will be doing for this aspect; if you do <em>not</em> filter your data, clearly explain why not (most likely because the article stated a proper reason)</li>
<li>Perform the filtering on your dataset. For this you will most likely need to use one of the <code>apply</code> functions, combined with maybe the <code>which</code>, <code>all</code> and <code>any</code> functions.</li>
<li>Manually verify that the rows removed were correctly filtered.</li>
<li>Properly document how many genes have been filtered out!</li>
</ul></li>
</ul>
</div>
<div id="deg-fc" class="section level2">
<h2><span class="header-section-number">4.2</span> The <em>Fold Change</em> Value</h2>
<p>The FC is usually given as the calculated <code>log2</code> of the <em>case/control</em> ratio. For example, gene A has an average expression of 30 mapped reads in the control group and 88 reads in the experiment group, the ratio <em>case/control</em> is <code>2.93</code>. Values &gt; 1 indicate increased expression in the experiment in relation to the control and values between 0 and 1 indicate lower expression. The <code>log2(2.93)</code> is <code>1.55</code>. If the counts were reversed, the ratio would have been <code>30/88</code>, which is <code>0.34</code>. The previously calculated value of <code>2.93</code> means a 3-fold up regulation while the <code>0.34</code> value means 3-fold down regulation but you can see the range of numbers is very different. Comparing log2 values this would be <code>1.55</code> and <code>-1.55</code> which compares much better.</p>
<p>While it is very easy to calculate the FC for all genes at once, a simple FC value doesn’t mean much, yet! We still need to use the power that lie within the replicates we have for each sample group. Using these replicates, we want to determine if the observed FC is not just biological noise or a sequencing error.</p>
<ul>
<li><strong>Assignment</strong>: Create a <code>histogram</code> of your log2-FC values for <em>all</em> genes. Apply the following steps to do this:
<ul>
<li>average the replicates for each group and add this as a new column to your data set,</li>
<li>calculate the ratios; simply divide one group (averaged-column) by another, usually <code>experiment</code>/<code>control</code>,</li>
<li>perform a log2-transformation (now you have the <code>log2-FC</code> values),</li>
<li>plot the data using the <code>hist(logFC_column, breaks=60)</code> function (change the <code>breaks</code> argument if needed),</li>
<li>Add two vertical lines at <code>-1</code> and <code>1</code> (using <code>abline(v=...)</code>) to indicate some significance (2-fold change).</li>
</ul></li>
</ul>
<p>If a calculated FC shows a large change in expression between groups this means nothing if the variation <em>within</em> a group is very high. For this reason we use some form of statistical test that checks both the variation in each group <em>and</em> the difference between groups of samples. In the simplest form this usually comes down to using a <a href="https://en.wikipedia.org/wiki/Student%27s_t-test"><em>t</em>-test</a>:</p>
<blockquote>
<p>“It can be used to determine if two sets of data are significantly different from each other”</p>
</blockquote>
<p>It does however depend on your experimental setup when it comes down to deciding the proper statistical test to perform and for that it is best to look at your experiment article to see what the authors used for method.</p>
<p>The output of finding DEG’s always includes - but is not limited to - a list of <em>p-values</em>, usually one p-value per gene. This value indicates whether that gene is a <em>statistically-significant differentially expressed gene</em> (SDEG) and to find these genes of interest all we need to do is get all genes with a p-value below our threshold (i.e. <code>0.05</code>). Because we will get at least two p-values per gene (one found using manually statistical testing and one through the use of a library) we can make multiple selections, i.e. compare methods, find genes that have a low p-value in both methods and visualize these results in a <em>venn-diagram</em> (see section <a href="#deg-visualization">visualization</a>).</p>
</div>
<div id="deg-manual" class="section level2">
<h2><span class="header-section-number">4.3</span> Using Manual Methods (<code>t-test</code> &amp; <code>ANOVA</code>)</h2>
<p>Performing the statistical tests yourself consists of performing either a t-test or an ANOVA based analysis. Both of these methods have multiple forms and the one to choose fully depends on what question you’d like to ask. Again, refer to your experimental setup and any hints found in the article <em>or</em> formulate your own question and base the decision on that.</p>
<p>Manually performing a t-test or ANOVA on gene expression opposed to using one of the specialized libraries can have advantages since every gene is processed individually, while <code>edgeR</code> and <code>DESeq2</code> look at <em>all</em> genes and this might ‘smooth’ the results which is not always wanted. We will find out later if and how this affects your data set.</p>
<p>If your data <strong>only</strong> consists of the read counts there is an extra normalisation step to perform (only for the manual methods explained in this section, keep the count data stored as well!). One generally accepted method of normalizing count data is to calculate the <em>fragments per million mapped fragments</em> (FPM) value and then transform this with log2. Opposed to FPKM and RPKM this does not include the gene-length in its calculation (which you most likely don’t have) but as said before we apply the test per gene and do not need to compare multiple genes. If your dataset also includes FPKM or RPKM (pre-normalized), you are allowed to use this data too. Always clearly document if you did so! Once you performed a manual statistical text, be sure to read the section on <a href="chapter-4.html#deg-mtc">Multiple Testing Correction</a> further on in this chapter.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="co"># Perform FPM normalization using DESeq2 &#39;fpm&#39; and perform log2 transformation</span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="co"># The &#39;ddsMat&#39; object is the &#39;DESeqDataSet&#39; created in chapter 4.</span></a>
<a class="sourceLine" id="cb20-3" data-line-number="3"><span class="co"># </span><span class="al">NOTE</span><span class="co">: only for count data</span></a>
<a class="sourceLine" id="cb20-4" data-line-number="4">counts.fpm &lt;-<span class="st"> </span><span class="kw">log2</span>( <span class="kw">fpm</span>(ddsMat, <span class="dt">robust =</span> <span class="ot">TRUE</span>) )</a></code></pre></div>
<p>Next is selecting the test to perform, the following links show diagrams that can be used once the experimental design is known:</p>
<p><em>What test to use</em> links:</p>
<ul>
<li><a href="https://stats.idre.ucla.edu/other/mult-pkg/whatstat/choosestat-html/">Institute for Digital Research and Education</a></li>
<li><a href="http://www.biochemia-medica.com/content/comparing-groups-statistical-differences-how-choose-right-statistical-test">Biochemia - image at the bottom of the article</a></li>
<li><a href="http://www.practicallyscience.com/wp-content/uploads/2015/07/significance-tests-v4-op2.jpg">PracticallyScience</a></li>
</ul>
<div id="deg-ttest" class="section level3">
<h3><span class="header-section-number">4.3.1</span> Students T-test</h3>
<p>In order to test if one or more genes are significantly differentially expressed between two conditions one can perform a t-test. The t-test will test the <em>null hypothesis</em> that there is no difference between the mean of the two populations. Usually, if the p-value is below the significance threshold chosen (also called alpha-value, usually set at <span class="math inline">\(\alpha\)</span> <code>0.05</code>) you reject the null hypothesis and conclude that there is a significant difference between the means. Note that you need to perform a single t-test for <em>every</em> gene (row) of your data set, including all replicates for the involved group.</p>
<p>From the output of the t-test you only need to keep the calculated <em>p-value</em>; one value per gene (row) in your data set. In R, you can append this as a column to your dataframe/ matrix containing the normalized count values.</p>
<p><em>t.test</em> tutorials:</p>
<ul>
<li><a href="http://www.statmethods.net/stats/ttest.html">Quick-R @ statmethods</a></li>
<li><a href="http://jura.wi.mit.edu/bio/education/bioinfo2007/arrays/array_exercises_2R.html">Whitehead Institute</a>: based on microarray analysis, but it’s still expression data and the basics are the same.</li>
</ul>
</div>
<div id="deg-anova" class="section level3">
<h3><span class="header-section-number">4.3.2</span> Analysis of Variance (<code>ANOVA</code>)</h3>
<p>If you have decided that you need to perform an ANOVA analysis the experimental design as well as the question to ask become much more important.</p>
<p><em>ANOVA</em> tutorials</p>
<ul>
<li><a href="http://www.statmethods.net/stats/anova.html">Quick-R @ statmethods</a></li>
<li><a href="http://www.r-bloggers.com/one-way-analysis-of-variance-anova/">R-bloggers</a></li>
</ul>
</div>
</div>
<div id="deg-mtc" class="section level2">
<h2><span class="header-section-number">4.4</span> Multiple Testing Correction</h2>
<p>Read the text about <strong>Multiple comparisons</strong> at the <a href="http://www.biostathandbook.com/multiplecomparisons.html">biostathandbook</a> and the help of the <code>p.adjust R</code> function. Your article is a possible source to see which correction method they applied and this is not mentioned there it is probably best to use the <code>fdr</code> method (also called the <code>Benjamini Hochberg</code> method).</p>
<p>An expected side-effect of correcting for multiple-testing is the lower number of genes with a resulting p-value &lt; 0.05 (caused by hopefuly removing false-positives). In some cases though, you end up with <strong>0</strong> genes that have a low p-value and thus you have no DEGs.</p>
</div>
<div id="deg-bioconductor" class="section level2">
<h2><span class="header-section-number">4.5</span> Using Bioconductor</h2>
<p>This section demonstrates the use of two packages to perform DEG-analysis on <strong>count</strong> data and one library for processed FPKM/RPKM data. There are many packages available on Bioconductor for similar analysis, such as <code>DSS</code>, <code>EBSeq</code> and <code>BaySeq</code> but here we will focus on <code>edgeR</code> and <code>DESeq2</code> for processing count-based data and briefly take a look at <code>limma</code> for processing FPKM/RPKM data.</p>
<p>Both <code>edgeR</code> and <code>DESeq2</code> apply their own normalization methods (described in the sections below) therefore they only work on the count data. You can choose one of these two packages to use, or use both since it could increase statistical power and they are not very hard to use once you understand how to model the data as we’ll show next.</p>
<div id="deg-design" class="section level3">
<h3><span class="header-section-number">4.5.1</span> The <code>Design</code> (matrix)</h3>
<p>For all of these packages you need to properly specify <em>how</em> your samples are grouped. We have seen examples of this using an <code>R factor</code> object with the heatmap, MDS and PCA visualizations to tell which groups of samples we have and to which group each sample belongs. Reading the documentation for the below packages shows that this is an important part of performing DE-analysis. For example, the following code is shown in de <code>edgeR</code> documentation on page 8 where two sample groups are defined (numbered <code>1</code> and <code>2</code>), placed in a <code>factor</code> object and used as input in the <code>model.matrix</code> function.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">group &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>), <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Control&quot;</span>, <span class="st">&quot;Case&quot;</span>))</a>
<a class="sourceLine" id="cb21-2" data-line-number="2">(design &lt;-<span class="st"> </span><span class="kw">model.matrix</span>( <span class="op">~</span><span class="st"> </span>group))</a></code></pre></div>
<pre><code>##   (Intercept) groupCase
## 1           1         0
## 2           1         0
## 3           1         1
## 4           1         1
## attr(,&quot;assign&quot;)
## [1] 0 1
## attr(,&quot;contrasts&quot;)
## attr(,&quot;contrasts&quot;)$group
## [1] &quot;contr.treatment&quot;</code></pre>
<p>As mentioned before we <strong>need</strong> to think about the <em>question</em> we want to aks; which difference do we want to know? With two sample groups as used here the question is rather easy; ‘which genes show an effect between case/ control samples?’. With more then two sample groups however the question becomes more difficult. If we have an experiment comparing influence of three kinds of drugs (thus three groups) <em>combined</em> with effect over time, do we then want to focus on the influence of the <em>drugs</em> or the <em>time</em>? Both are valid questions but they define the way of how to create the <code>design matrix</code>.</p>
<p>Documentation on this subject is plenty, however it often contains overwhelming information. <a href="http://genomicsclass.github.io/book/pages/expressing_design_formula.html">This page</a> contains some valuable details (you can safely start reading at <strong>Choice of design</strong>), including the following text which is based on the same example used in the <code>edgeR</code> documentation:</p>
<blockquote>
<p>“For the examples we cover here, we use linear models to make comparisons between different groups. Hence, the design matrices that we ultimately work with will have at least two columns: an intercept column, which consists of a column of 1’s, and a second column, which specifies which samples are in a second group. In this case, two coefficients are fit in the linear model: the intercept, which represents the population average of the first group, and a second coefficient, which represents the difference between the population averages of the second group and the first group. The latter is typically the coefficient we are interested in when we are performing statistical tests: we want to know if their is a difference between the two groups.”</p>
</blockquote>
<p>If you have more then two sample groups and you want to change the <em>question</em> (i.e. test the influence of a different group), read the section about <strong>Releveling</strong> the <code>factor</code>.</p>
</div>
<div id="deg-deseq2" class="section level3">
<h3><span class="header-section-number">4.5.2</span> <code>DESeq2</code></h3>
<p>We have used the <code>DESeq2</code> library before and for DEG analysis we could re-use the <code>DESeqDataSet</code> object but it is adviced to create a new object with more data added, e.g. the sample annotation we retrieved from the GEO and the proper design formula instead of the <code>~ 1</code> we used before.</p>
<p>There is no need to normalize the data using the previously used <code>rlog</code> function because the <code>DESeq2</code> library will normalize the count data for you as follows:</p>
<blockquote>
<p>“DESeq computes a scaling factor for a given sample by computing the median of the ratio, for each gene, of its read count over its geometric mean across all samples. It then uses the assumption that most genes are not DE and uses this median of ratios to obtain the scaling factor associated with this sample.”</p>
</blockquote>
<p>For our example data with just two groups we use the design <code>~ groups</code> where groups is a simple factor with two levels (<code>KO</code> and <code>WT</code>). One note of importance though is that the first level in the factor is taken as the reference, or for expression analysis, the <em>control</em> group. In the example factor the <code>KO</code> level is the first which is the <em>experiment</em> group. Therefore we need to <em>relevel</em> the data (check the help and documentation if this is unclear):</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1">(groups &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>), <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&#39;KO&#39;</span>, <span class="st">&#39;WT&#39;</span>)))</a></code></pre></div>
<pre><code>## [1] KO KO KO WT WT WT WT
## Levels: KO WT</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">(groups &lt;-<span class="st"> </span><span class="kw">relevel</span>(groups, <span class="st">&#39;WT&#39;</span>))</a></code></pre></div>
<pre><code>## [1] KO KO KO WT WT WT WT
## Levels: WT KO</code></pre>
<p>Once you have a proper <code>DESeqDataSet</code> all you need to do is run the <code>DESeq</code> function on this object. Then, using the <code>results</code> function you can extract the DEGs as a <code>DESeqResults</code> object. Applying the <code>summary</code> function on this object shows the number of up and down regulated DEGs:</p>
<pre><code>## 
## out of 20098 with nonzero total read count
## adjusted p-value &lt; 0.05
## LFC &gt; 0 (up)     : 234, 1.2% 
## LFC &lt; 0 (down)   : 289, 1.4% 
## outliers [1]     : 0, 0% 
## low counts [2]   : 5023, 25% 
## (mean count &lt; 12)
## [1] see &#39;cooksCutoff&#39; argument of ?results
## [2] see &#39;independentFiltering&#39; argument of ?results</code></pre>
<p>The output of the <code>results</code> function contains the following columns for each gene:</p>
<table style="width:89%;">
<colgroup>
<col width="23%" />
<col width="20%" />
<col width="44%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">Column</th>
<th align="center">Type</th>
<th align="center">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">baseMean</td>
<td align="center">intermediate</td>
<td align="center">mean of normalized counts for
all samples</td>
</tr>
<tr class="even">
<td align="center">log2FoldChange</td>
<td align="center">results</td>
<td align="center">log2 fold change (MLE): groups
KO vs WT</td>
</tr>
<tr class="odd">
<td align="center">lfcSE</td>
<td align="center">results</td>
<td align="center">standard error: groups KO vs
WT</td>
</tr>
<tr class="even">
<td align="center">stat</td>
<td align="center">results</td>
<td align="center">Wald statistic: groups KO vs
WT</td>
</tr>
<tr class="odd">
<td align="center">pvalue</td>
<td align="center">results</td>
<td align="center">Wald test p-value: groups KO
vs WT</td>
</tr>
<tr class="even">
<td align="center">padj</td>
<td align="center">results</td>
<td align="center">BH adjusted p-values</td>
</tr>
</tbody>
</table>
<p><em>How</em> you call the <code>results</code> function depends heavily on your experiment. As you can see from the output of the <code>summary</code> function, there are no details given about <em>which</em> comparison is shown (and also, a p-value of 0.1 is used instead of 0.05).</p>
<p>Depending on the <em>design</em> used to create the <code>DESeqDataSet</code> with, one or more comparisons can be made (applying the <code>DESeq</code> function calculates all and you filter with the <code>results</code> function). Read the help for the <code>results</code> function carefully; especially regarding the <code>contrast</code> argument where you define the comparison to retrieve. The following code is used for our example experiment:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1">res &lt;-<span class="st"> </span><span class="kw">results</span>(dds, <span class="dt">contrast =</span> <span class="kw">c</span>(<span class="st">&quot;groups&quot;</span>, <span class="st">&quot;KO&quot;</span>, <span class="st">&quot;WT&quot;</span>), </a>
<a class="sourceLine" id="cb28-2" data-line-number="2">               <span class="dt">alpha =</span> <span class="fl">0.05</span>)</a></code></pre></div>
<p><strong>Links</strong></p>
<ul>
<li><a href="https://www.bioconductor.org/packages/devel/bioc/vignettes/DESeq2/inst/doc/DESeq2.html">Analyzing RNA-seq data with DESeq2</a> A <em>very</em> comprehensive guide to analyzing RNA-Seq data using DESeq2 (part of this document has been used in this material too!). It is adviced to read the first few sections of this guide and take a good look at the index of the document because there are many interesting sections that might be of help later.</li>
<li><a href="https://genomebiology.biomedcentral.com/articles/10.1186/s13059-014-0550-8">Publication</a>, an accompanying article showing differences in performance compared to other methods and packages.</li>
</ul>
</div>
<div id="deg-edger" class="section level3">
<h3><span class="header-section-number">4.5.3</span> <code>edgeR</code></h3>
<p>One of the most mature libraries for RNA-Seq data analysis is the <code>edgeR</code> library available on <a href="">Bioconductor</a>. There is a very complete (sometimes a bit complex) manual available of which you need to read <a href="https://bioconductor.org/packages/release/bioc/vignettes/edgeR/inst/doc/edgeRUsersGuide.pdf">Chapter 2</a> with a focus on 2.1 to 2.7, 2.9 and - if you have a more complex design - 2.10. Section 1.4 (Quickstart) shows a code example on the steps needed to do DEG analysis using count data using the two <code>glm</code> methods (<em>quasi-likelihood F-tests</em> and <em>likelihood ratio tests</em>). All the steps shown there are identical for the non-<code>glm</code> method up to calculating the <code>fit</code> object which can be replaced by performing the <code>exactTest</code> function as shown in sectino 2.9.2.</p>
<p>The <code>edgeR</code> library will normalize the count data for you as follows:</p>
<blockquote>
<p>“The trimmed means of M values (TMM) from Robinson and Oshlack, which is implemented in edgeR, computes a scaling factor between two experiments by using the weighted average of the subset of genes after excluding genes that exhibit high average read counts and genes that have large differences in expression.”</p>
</blockquote>
<p>Running edgeR requires the raw count data together with the grouping-factor packaged in a <code>DGEList</code> object (with the <code>DGEList()</code> function). Furthermore, a proper <code>model.matrix</code> object (see the section on <a href="chapter-4.html#deg-design">design</a>) is needed as input for the <code>estimateDisp</code> function. The exact steps to take (there are more variations then with DeSEQ) must be searched in the documentation linked above.</p>
<p>Gene annotation has been added to the <code>DGEList</code> object that is used to run edgeR with the <code>genes</code> parameter. This data has been taken from the <code>AnnotationDbi</code> package as <a href="#annotationDBI">shown in chapter 5</a>.</p>
<p>Once the analysis is done you can retrieve the actual results with the <code>topTags</code> function:</p>
<table style="width:81%;">
<caption>Most significant genes given by edgeR</caption>
<colgroup>
<col width="19%" />
<col width="12%" />
<col width="12%" />
<col width="18%" />
<col width="18%" />
</colgroup>
<thead>
<tr class="header">
<th align="center"> </th>
<th align="center">logFC</th>
<th align="center">logCPM</th>
<th align="center">PValue</th>
<th align="center">FDR</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>Igf2as</strong></td>
<td align="center">-3.389</td>
<td align="center">5.284</td>
<td align="center">6.222e-108</td>
<td align="center">9.969e-104</td>
</tr>
<tr class="even">
<td align="center"><strong>Angptl4</strong></td>
<td align="center">1.063</td>
<td align="center">5.884</td>
<td align="center">2.846e-24</td>
<td align="center">2.28e-20</td>
</tr>
<tr class="odd">
<td align="center"><strong>St8sia5</strong></td>
<td align="center">-1.318</td>
<td align="center">2.696</td>
<td align="center">8.637e-15</td>
<td align="center">3.04e-11</td>
</tr>
<tr class="even">
<td align="center"><strong>Mrgprb1</strong></td>
<td align="center">0.8404</td>
<td align="center">4.129</td>
<td align="center">8.826e-15</td>
<td align="center">3.04e-11</td>
</tr>
<tr class="odd">
<td align="center"><strong>Acot2</strong></td>
<td align="center">1.113</td>
<td align="center">5.531</td>
<td align="center">9.487e-15</td>
<td align="center">3.04e-11</td>
</tr>
<tr class="even">
<td align="center"><strong>Camk2b</strong></td>
<td align="center">-0.823</td>
<td align="center">6.836</td>
<td align="center">2.576e-14</td>
<td align="center">6.879e-11</td>
</tr>
<tr class="odd">
<td align="center"><strong>Frzb</strong></td>
<td align="center">-1.258</td>
<td align="center">4.477</td>
<td align="center">4.54e-14</td>
<td align="center">1.039e-10</td>
</tr>
<tr class="even">
<td align="center"><strong>Cd36</strong></td>
<td align="center">0.7175</td>
<td align="center">9.023</td>
<td align="center">1.288e-13</td>
<td align="center">2.58e-10</td>
</tr>
<tr class="odd">
<td align="center"><strong>Slc2a5</strong></td>
<td align="center">-1.725</td>
<td align="center">1.688</td>
<td align="center">4.355e-13</td>
<td align="center">7.753e-10</td>
</tr>
<tr class="even">
<td align="center"><strong>Chi3l3</strong></td>
<td align="center">2.104</td>
<td align="center">0.3187</td>
<td align="center">5.666e-13</td>
<td align="center">9.078e-10</td>
</tr>
</tbody>
</table>
<p>The package also contains a few plotting methods that you can use at intermediate steps during the analysis. For instance, after calculating the normalization factors (<code>calcNormFactors</code>), you can perform multi-dimensional scaling with the <code>plotMDS</code> function:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw">plotMDS</span>(y)</a></code></pre></div>
<p><img src="gene_expression_files/figure-html4/unnamed-chunk-1-1.png" width="672" /></p>
<p>Or the <em>dispersion</em> after running the <code>estimateDisp</code> function with the <code>plotBCV</code> function:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="kw">plotBCV</span>(y)</a></code></pre></div>
<p><img src="gene_expression_files/figure-html4/unnamed-chunk-2-1.png" width="672" /></p>
<p>Or the log-fold changes for all genes, once we have the output of the <code>exactTest</code> function (output <code>et</code> is an <code>DGEExact</code> object) with the <code>plotSmear</code> function. The <code>abline</code> shows a log-FC threshold:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1">deGenes &lt;-<span class="st"> </span><span class="kw">decideTestsDGE</span>(et, <span class="dt">p=</span><span class="fl">0.001</span>)</a>
<a class="sourceLine" id="cb31-2" data-line-number="2">deGenes &lt;-<span class="st"> </span><span class="kw">rownames</span>(et)[<span class="kw">as.logical</span>(deGenes)]</a>
<a class="sourceLine" id="cb31-3" data-line-number="3"><span class="kw">plotSmear</span>(et, <span class="dt">de.tags=</span>deGenes)</a>
<a class="sourceLine" id="cb31-4" data-line-number="4"><span class="kw">abline</span>(<span class="dt">h=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="dt">col=</span><span class="dv">2</span>)</a></code></pre></div>
<p><img src="gene_expression_files/figure-html4/unnamed-chunk-3-1.png" width="672" /></p>
<p><strong>Links</strong></p>
<ul>
<li><a href="http://bioinformatics-core-shared-training.github.io/cruk-bioinf-sschool/Day3/rnaSeq_DE.pdf">Differential Expression Analysis using edgeR</a> tutorial</li>
<li><a href="https://gist.github.com/jdblischak/11384914">Another tutorial</a> hosted on GitHub</li>
</ul>

<div id="refs" class="references">
<div>
<p>al., Patrick Deelen et. 2015. “Calling Genotypes from Public Rna-Sequencing Data Enables Identification of Genetic Variants That Affect Gene-Expression Levels.” <em>Genome Medicine</em> 7 (30).</p>
</div>
<div>
<p>Chen, Yunshun, Aaron Lun, Davis McCarthy, Xiaobei Zhou, Mark Robinson, and Gordon Smyth. 2018. <em>EdgeR: Empirical Analysis of Digital Gene Expression Data in R</em>. <a href="http://bioinf.wehi.edu.au/edgeR" class="uri">http://bioinf.wehi.edu.au/edgeR</a>.</p>
</div>
<div>
<p>Daróczi, Gergely, and Roman Tsegelskyi. 2017. <em>Pander: An R ’Pandoc’ Writer</em>. <a href="https://CRAN.R-project.org/package=pander" class="uri">https://CRAN.R-project.org/package=pander</a>.</p>
</div>
<div>
<p>Love, Michael, Simon Anders, and Wolfgang Huber. 2017. <em>DESeq2: Differential Gene Expression Analysis Based on the Negative Binomial Distribution</em>. <a href="https://github.com/mikelove/DESeq2" class="uri">https://github.com/mikelove/DESeq2</a>.</p>
</div>
</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="chapter-3.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
