<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title> Data Analysis and Visualization | Transcriptomics Project - Gene Expression Analysis</title>
  <meta name="description" content="Transcriptomics Project" />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content=" Data Analysis and Visualization | Transcriptomics Project - Gene Expression Analysis" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Transcriptomics Project" />
  <meta name="github-repo" content="mkempenaar/gene_expression_analysis" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content=" Data Analysis and Visualization | Transcriptomics Project - Gene Expression Analysis" />
  
  <meta name="twitter:description" content="Transcriptomics Project" />
  

<meta name="author" content="Marcel Kempenaar" />


<meta name="date" content="2025-04-25" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="chapter-4.html"/>
<link rel="next" href="a2-data_loading.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Capstone Project</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#transcriptomics-project---analysis-of-gene-expression"><i class="fa fa-check"></i><b>1.1</b> Transcriptomics Project - Analysis of Gene Expression</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#project-deliverables"><i class="fa fa-check"></i><b>1.2</b> Project Deliverables</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#project-schedule"><i class="fa fa-check"></i><b>1.3</b> Project Schedule</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#learning-outcomes-los"><i class="fa fa-check"></i><b>1.4</b> Learning Outcomes (LOs)</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#grading"><i class="fa fa-check"></i><b>1.5</b> Grading</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#lab-journal"><i class="fa fa-check"></i><b>1.6</b> <em>Lab Journal</em></a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#dashboard"><i class="fa fa-check"></i><b>1.7</b> Dashboard</a></li>
<li class="chapter" data-level="1.8" data-path="index.html"><a href="index.html#article"><i class="fa fa-check"></i><b>1.8</b> Article</a>
<ul>
<li class="chapter" data-level="1.8.1" data-path="index.html"><a href="index.html#installing-the-article-template"><i class="fa fa-check"></i><b>1.8.1</b> Installing the Article Template</a></li>
<li class="chapter" data-level="1.8.2" data-path="index.html"><a href="index.html#using-the-template"><i class="fa fa-check"></i><b>1.8.2</b> Using the Template</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="datasets.html"><a href="datasets.html"><i class="fa fa-check"></i><b>2</b> Discovering RNA-Seq Data Sets</a>
<ul>
<li class="chapter" data-level="2.1" data-path="datasets.html"><a href="datasets.html#finding-public-data"><i class="fa fa-check"></i><b>2.1</b> Finding Public Data Sets of Interest</a></li>
<li class="chapter" data-level="2.2" data-path="datasets.html"><a href="datasets.html#ncbi-geo"><i class="fa fa-check"></i><b>2.2</b> The NCBI <em>Gene Expression Omnibus</em></a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="EDA.html"><a href="EDA.html"><i class="fa fa-check"></i><b>3</b> Exploratory Data Analysis</a>
<ul>
<li class="chapter" data-level="3.1" data-path="EDA.html"><a href="EDA.html#loading-data"><i class="fa fa-check"></i><b>3.1</b> Loading data into R</a></li>
<li class="chapter" data-level="3.2" data-path="EDA.html"><a href="EDA.html#ch3_example_data"><i class="fa fa-check"></i><b>3.2</b> Example Data</a></li>
<li class="chapter" data-level="3.3" data-path="EDA.html"><a href="EDA.html#EDA_part1"><i class="fa fa-check"></i><b>3.3</b> Visualizing using <code>boxplot</code> and <code>density plot</code></a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="EDA.html"><a href="EDA.html#eda_statistics"><i class="fa fa-check"></i><b>3.3.1</b> Statistics</a></li>
<li class="chapter" data-level="3.3.2" data-path="EDA.html"><a href="EDA.html#eda_boxplots"><i class="fa fa-check"></i><b>3.3.2</b> Boxplots</a></li>
<li class="chapter" data-level="3.3.3" data-path="EDA.html"><a href="EDA.html#eda_density_plot"><i class="fa fa-check"></i><b>3.3.3</b> Density Plots</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="EDA.html"><a href="EDA.html#EDA_part2"><i class="fa fa-check"></i><b>3.4</b> Visualizing using <code>heatmap</code> and <code>MDS</code></a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="EDA.html"><a href="EDA.html#normalization"><i class="fa fa-check"></i><b>3.4.1</b> Normalization</a></li>
<li class="chapter" data-level="3.4.2" data-path="EDA.html"><a href="EDA.html#eda_distance"><i class="fa fa-check"></i><b>3.4.2</b> Distance Calculation</a></li>
<li class="chapter" data-level="3.4.3" data-path="EDA.html"><a href="EDA.html#eda_heatmap"><i class="fa fa-check"></i><b>3.4.3</b> Sample Distances using a Heatmap</a></li>
<li class="chapter" data-level="3.4.4" data-path="EDA.html"><a href="EDA.html#eda_mds"><i class="fa fa-check"></i><b>3.4.4</b> Multi-Dimensional Scaling</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="EDA.html"><a href="EDA.html#cleaning-data"><i class="fa fa-check"></i><b>3.5</b> Cleaning Data</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="chapter-4.html"><a href="chapter-4.html"><i class="fa fa-check"></i><b>4</b> Discovering Differentialy Expressed Genes (DEGs)</a>
<ul>
<li class="chapter" data-level="4.1" data-path="chapter-4.html"><a href="chapter-4.html#deg-preprocessing"><i class="fa fa-check"></i><b>4.1</b> Pre-processing</a></li>
<li class="chapter" data-level="4.2" data-path="chapter-4.html"><a href="chapter-4.html#deg-fc"><i class="fa fa-check"></i><b>4.2</b> The <em>Fold Change</em> Value</a></li>
<li class="chapter" data-level="4.3" data-path="chapter-4.html"><a href="chapter-4.html#deg-bioconductor"><i class="fa fa-check"></i><b>4.3</b> Using Bioconductor Packages</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Transcriptomics Project - Gene Expression Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chapter-5" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number"></span> Data Analysis and Visualization<a href="chapter-5.html#chapter-5" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>At this point we have one or more sets of DEGs from our experiment. It might be just one set or it might be a large number of comparisons made with a set of DEGs per comparison and/ or results from multiple approaches (manual, packages). This chapter offers some guidance to visualize, summarize and - finally - connect some biological relevance to the results. <strong>Browse this chapter first</strong> before choosing the visualization(s) to make for your data! If your article contains relevant figures that you would like to try and reproduce (given that enough data is available) that can be done as well instead of the visualizations shown here. Note however that the Volcano plot described below <strong>is</strong> required.</p>
<div id="volcano" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Volcano Plot<a href="chapter-5.html#volcano" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A volcano plot is often the first visualization of the data once the statistical tests are completed. This plot shows data for <em>all</em> genes and we highlight those genes that are considered DEG by using thresholds for both the (adjusted) p-value and a fold-change. Many articles describe values used for these thresholds in their methods section, otherwise a good default is 0.05 for the adjusted p-value and around 1.0 for the log-FC.</p>
<p>Here we use the <code>EnhancedVolcano</code> library that creates a <code>ggplot2</code> volcano plot as shown below. This is packaged in a function <code>deseq.volcano</code> just because we create two figures and only need to change the input data set and plot title. The resulting scatterplot places the <code>-log10(pvalue)</code> values on the y-axis and the log-FC on the x-axis. This often results in a plot representing a volcanic ‘eruption’ where the fold-change influences the spread and the significance the height. Coloring is done based on the thresholds (-log10(0.05) for the adjusted and log2(2) for the log-FC) as follows:</p>
<ul>
<li>(dark) gray: not significant; both the FC and adjusted p-value is below the thresholds.</li>
<li>green: high FC, but adjusted p-value is below the threshold.</li>
<li>blue: adjusted p-value indicates significance, but FC below the threshold</li>
<li>red: significant DEG</li>
</ul>
<p>You can adjust the <code>pCutoff</code> and <code>FCcutoff</code> values depending on your own requirements, see the elaborate <a href="https://github.com/kevinblighe/EnhancedVolcano">documentation and examples</a> on GitHub. The code below <em>wraps</em> the <code>EnhancedVolcano</code> function in a custom function (<code>deseq.volcano</code>) that can be used when there are multiple comparisons to make.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="chapter-5.html#cb26-1" tabindex="-1"></a><span class="fu">library</span>(EnhancedVolcano)</span>
<span id="cb26-2"><a href="chapter-5.html#cb26-2" tabindex="-1"></a></span>
<span id="cb26-3"><a href="chapter-5.html#cb26-3" tabindex="-1"></a><span class="do">## Simple function for plotting a Volcano plot, returns a ggplot object</span></span>
<span id="cb26-4"><a href="chapter-5.html#cb26-4" tabindex="-1"></a>deseq.volcano <span class="ot">&lt;-</span> <span class="cf">function</span>(res, datasetName) {</span>
<span id="cb26-5"><a href="chapter-5.html#cb26-5" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">EnhancedVolcano</span>(res, <span class="at">x =</span> <span class="st">&#39;log2FoldChange&#39;</span>, <span class="at">y =</span> <span class="st">&#39;padj&#39;</span>,</span>
<span id="cb26-6"><a href="chapter-5.html#cb26-6" tabindex="-1"></a>                         <span class="at">lab=</span><span class="fu">rownames</span>(res),</span>
<span id="cb26-7"><a href="chapter-5.html#cb26-7" tabindex="-1"></a>                         <span class="at">title =</span> <span class="fu">paste</span>(datasetName, <span class="st">&quot;trisomic vs disomic&quot;</span>),</span>
<span id="cb26-8"><a href="chapter-5.html#cb26-8" tabindex="-1"></a>                         <span class="at">subtitle =</span> <span class="fu">bquote</span>(<span class="fu">italic</span>(<span class="st">&#39;FDR &lt;= 0.05 and absolute FC &gt;= 2&#39;</span>)),</span>
<span id="cb26-9"><a href="chapter-5.html#cb26-9" tabindex="-1"></a>                         <span class="co"># Change text and icon sizes</span></span>
<span id="cb26-10"><a href="chapter-5.html#cb26-10" tabindex="-1"></a>                         <span class="at">labSize =</span> <span class="dv">3</span>, <span class="at">pointSize =</span> <span class="fl">1.5</span>, <span class="at">axisLabSize=</span><span class="dv">10</span>, <span class="at">titleLabSize=</span><span class="dv">12</span>,</span>
<span id="cb26-11"><a href="chapter-5.html#cb26-11" tabindex="-1"></a>                         <span class="at">subtitleLabSize=</span><span class="dv">8</span>, <span class="at">captionLabSize=</span><span class="dv">10</span>,</span>
<span id="cb26-12"><a href="chapter-5.html#cb26-12" tabindex="-1"></a>                         <span class="co"># Disable legend</span></span>
<span id="cb26-13"><a href="chapter-5.html#cb26-13" tabindex="-1"></a>                         <span class="at">legendPosition =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb26-14"><a href="chapter-5.html#cb26-14" tabindex="-1"></a>                         <span class="co"># Set cutoffs</span></span>
<span id="cb26-15"><a href="chapter-5.html#cb26-15" tabindex="-1"></a>                         <span class="at">pCutoff =</span> <span class="fl">0.05</span>, <span class="at">FCcutoff =</span> <span class="dv">2</span>))</span>
<span id="cb26-16"><a href="chapter-5.html#cb26-16" tabindex="-1"></a>}</span>
<span id="cb26-17"><a href="chapter-5.html#cb26-17" tabindex="-1"></a></span>
<span id="cb26-18"><a href="chapter-5.html#cb26-18" tabindex="-1"></a><span class="do">## Note: input data is the corrected DESeq2 output using the &#39;lfcShrink&#39; function (see chapter 4)</span></span>
<span id="cb26-19"><a href="chapter-5.html#cb26-19" tabindex="-1"></a><span class="fu">deseq.volcano</span>(<span class="at">res =</span> res.ipsc.lfc, <span class="at">datasetName =</span> <span class="st">&quot;IPSC&quot;</span>)</span></code></pre></div>
<p><img src="gene_expression_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="chapter-5.html#cb27-1" tabindex="-1"></a><span class="fu">deseq.volcano</span>(<span class="at">res =</span> res.neuron.lfc, <span class="at">datasetName =</span> <span class="st">&quot;Neuron&quot;</span>)</span></code></pre></div>
<p><img src="gene_expression_files/figure-html/unnamed-chunk-8-2.png" width="672" /></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="chapter-5.html#cb28-1" tabindex="-1"></a><span class="do">## Note that the most simplest case is:</span></span>
<span id="cb28-2"><a href="chapter-5.html#cb28-2" tabindex="-1"></a><span class="fu">EnhancedVolcano</span>(res.ipsc, <span class="at">x =</span> <span class="st">&#39;log2FoldChange&#39;</span>, <span class="at">y =</span> <span class="st">&#39;padj&#39;</span>, <span class="at">lab =</span> <span class="fu">rownames</span>(res.ipsc))</span></code></pre></div>
<p><strong>Notes</strong>:</p>
<ul>
<li>When you have used edgeR instead you need to change the names of the columns (i.e. <code>log2FoldChange</code> == <code>logFC</code> and <code>padj</code> == <code>FDR</code>) used in this example.</li>
<li>In this example there are too many DEGs to annotate with their name in the plots. The <code>EnhancedVolcano</code> plot function has many options for annotating significant genes, see the linked manual for further information.</li>
</ul>
</div>
<div id="venn-diagram" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Venn Diagram<a href="chapter-5.html#venn-diagram" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Another common visualization is a Venn-diagram. With our data set we’ve shown two comparisons; trisomic vs disomic in two cell types. Using a Venn-diagram we can show both the <em>shared</em> and <em>unique</em> DEGS for the <em>IPSC trisomic vs IPSC disomic</em> and <em>NEUR trisomic vs NEUR disomic</em> comparisons.</p>
<p>Creating a Venn-diagram can be a good method for selecting a (sub)set of DEGs, for instance by selecting the set of DEGs that are shared between groups (the <em>Intersection</em>, see the <a href="https://en.wikipedia.org/wiki/Set_theory">Wikipedia page on Set Theory</a> or the other way around, only the DEGs that are unique for a group (the <em>Difference</em>). Keep this in mind when continuing on to the <a href="chapter-5.html#clustering">clustering</a> section below where it is most likely not useful to cluster all combinations you might have.</p>
<p>Code examples:</p>
<ul>
<li>Data preparation (first code-chunk): creating vectors of DEGs for both packages. These DEGs are the gene names (taken from the row names of each DEG-analysis).
<ul>
<li>The output of the DESeq2 <code>results</code> and <code>lfcShrink</code> functions are stored in the <code>res.ipsc.lfc</code> and <code>res.ipsc.neuron</code> objects.</li>
</ul></li>
<li>Using the <code>VennDiagram</code> library (second code-chunk): good for complex/ large number of comparison, highly configurable but more difficult to use. To see some examples, run the following function in the R console: <code>example('draw.quad.venn')</code></li>
<li>Using the <code>gplots</code> library (third code-chunk): Easier to use and support for complex Venn diagrams, but not good for adjusting appearance.</li>
</ul>
<p>See the blog post “<a href="https://www.datanovia.com/en/blog/venn-diagram-with-r-or-rstudio-a-million-ways/">VENN DIAGRAM WITH R OR RSTUDIO: A MILLION WAYS</a>” for more methods of creating Venn diagrams.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="chapter-5.html#cb29-1" tabindex="-1"></a><span class="do">## Data preparation</span></span>
<span id="cb29-2"><a href="chapter-5.html#cb29-2" tabindex="-1"></a>pval_threshold <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb29-3"><a href="chapter-5.html#cb29-3" tabindex="-1"></a>ipsc.degs <span class="ot">&lt;-</span> <span class="fu">row.names</span>(res.ipsc.lfc[<span class="fu">which</span>(res.ipsc.lfc<span class="sc">$</span>padj <span class="sc">&lt;=</span> pval_threshold), ])</span>
<span id="cb29-4"><a href="chapter-5.html#cb29-4" tabindex="-1"></a>neur.degs <span class="ot">&lt;-</span> <span class="fu">row.names</span>(res.neuron.lfc[<span class="fu">which</span>(res.neuron.lfc<span class="sc">$</span>padj <span class="sc">&lt;=</span> pval_threshold), ])</span></code></pre></div>
<p>The two created vectors of gene names can be used by either taking their lengths (for the <code>VennDiagram</code> library) or just their names (for the <code>gplots</code> library).</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="chapter-5.html#cb30-1" tabindex="-1"></a><span class="do">## Venn-diagram using the `VennDiagram` library (see below for alternative method)</span></span>
<span id="cb30-2"><a href="chapter-5.html#cb30-2" tabindex="-1"></a><span class="fu">library</span>(VennDiagram)</span>
<span id="cb30-3"><a href="chapter-5.html#cb30-3" tabindex="-1"></a><span class="co"># Arguments for a pairwise (two-sets) venn-diagram are sizes for set1, set2 and overlap (intersect)</span></span>
<span id="cb30-4"><a href="chapter-5.html#cb30-4" tabindex="-1"></a><span class="co"># Many more functions are available for triple, quad and quantuple diagrams (starting with &#39;draw.***&#39;)</span></span>
<span id="cb30-5"><a href="chapter-5.html#cb30-5" tabindex="-1"></a>venn.plot <span class="ot">&lt;-</span> <span class="fu">draw.pairwise.venn</span>(<span class="fu">length</span>(ipsc.degs),</span>
<span id="cb30-6"><a href="chapter-5.html#cb30-6" tabindex="-1"></a>                                <span class="fu">length</span>(neur.degs),</span>
<span id="cb30-7"><a href="chapter-5.html#cb30-7" tabindex="-1"></a>                                <span class="co"># Calculate the intersection of the two sets</span></span>
<span id="cb30-8"><a href="chapter-5.html#cb30-8" tabindex="-1"></a>                                <span class="fu">length</span>( <span class="fu">intersect</span>(ipsc.degs, neur.degs) ),</span>
<span id="cb30-9"><a href="chapter-5.html#cb30-9" tabindex="-1"></a>                                <span class="at">category =</span> <span class="fu">c</span>(<span class="st">&quot;IPSC Trisomic vs Disomic&quot;</span>, <span class="st">&quot;NEURON Trisomic vs Disomic&quot;</span>), <span class="at">scaled =</span> F,</span>
<span id="cb30-10"><a href="chapter-5.html#cb30-10" tabindex="-1"></a>                                <span class="at">fill =</span> <span class="fu">c</span>(<span class="st">&quot;light blue&quot;</span>, <span class="st">&quot;pink&quot;</span>), <span class="at">alpha =</span> <span class="fu">rep</span>(<span class="fl">0.5</span>, <span class="dv">2</span>),</span>
<span id="cb30-11"><a href="chapter-5.html#cb30-11" tabindex="-1"></a>                                <span class="at">cat.pos =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb30-12"><a href="chapter-5.html#cb30-12" tabindex="-1"></a></span>
<span id="cb30-13"><a href="chapter-5.html#cb30-13" tabindex="-1"></a><span class="co"># Actually plot the plot</span></span>
<span id="cb30-14"><a href="chapter-5.html#cb30-14" tabindex="-1"></a><span class="fu">grid.draw</span>(venn.plot)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:vennDiagram"></span>
<img src="gene_expression_files/figure-html/vennDiagram-1.png" alt="Venn diagram comparing IPSC and NEUR DEGs using 'VennDiagram' library" width="672" />
<p class="caption">
Figure 5.1: Venn diagram comparing IPSC and NEUR DEGs using ‘VennDiagram’ library
</p>
</div>
<p>As mentioned, following is an easier alternative (especially when you have &gt; 2 groups) with the <code>venn</code> function from the <code>gplots</code> library. This only needs a list containing either the row-numbers or the gene-names of the DEGs which is easier (but offers less adjustability to make it prettier).</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="chapter-5.html#cb31-1" tabindex="-1"></a><span class="do">## Alternative method using the `gplots` library</span></span>
<span id="cb31-2"><a href="chapter-5.html#cb31-2" tabindex="-1"></a><span class="fu">library</span>(gplots)</span>
<span id="cb31-3"><a href="chapter-5.html#cb31-3" tabindex="-1"></a><span class="co"># Create a Venn-diagram given just the list of gene-names for both sets</span></span>
<span id="cb31-4"><a href="chapter-5.html#cb31-4" tabindex="-1"></a><span class="fu">venn</span>(<span class="fu">list</span>(<span class="st">&quot;IPSC Trisomic vs Disomic&quot;</span> <span class="ot">=</span> ipsc.degs,</span>
<span id="cb31-5"><a href="chapter-5.html#cb31-5" tabindex="-1"></a>          <span class="st">&quot;NEURON Trisomic vs Disomic&quot;</span> <span class="ot">=</span> neur.degs), )</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:alternativeVenn"></span>
<img src="gene_expression_files/figure-html/alternativeVenn-1.png" alt="Venn diagram comparing IPSC and NEUR DEGs using 'gplots' library" width="672" />
<p class="caption">
Figure 5.2: Venn diagram comparing IPSC and NEUR DEGs using ‘gplots’ library
</p>
</div>
<p>While both analysis result in a similar amount of DEGS (849 for the IPSC and 769 for the Neuron cell types) only 96 DEGs are shared between both cell types and most are thus unique.</p>
</div>
<div id="clustering" class="section level2 hasAnchor" number="5.3">
<h2><span class="header-section-number">5.3</span> Clustering<a href="chapter-5.html#clustering" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Here, we can create a heatmap of the found DEGs for all samples where the colors show the fold-change value. Usually this heatmap is shown with a two color gradient; from red (downregulated) to green (upregulated). This is however optional and using the default colors from <code>pheatmap</code> for example is perfectly fine as long as a proper legend is present.</p>
<p>There are multiple methods of creating a heatmap (one of which you’ve already used) and most of these directly apply clustering in the visualization. This clustering can be applied to the expression pattern of a gene (row-clustering), the expression pattern of a sample (column-clustering) or both (default for <code>pheatmap</code>).</p>
<p>The following example is commonly found in publications as shows the log2 Fold Change values for the comparison that was done. The first and fifth columns show the log2(FC) as calculated by DESeq2 for the two trisomic vs disomic comparisons. The remaining columns are the log fold changes of the <em>separate</em> trisomic replicates vs the <em>average</em> disomic expression (manually calculating the Log(FC) as done in <a href="chapter-4.html#deg-fc">section 4.1</a> using the DESeq2 normalized count data from the <code>rld.dds</code> object). The DESeq2 calculated FC values show greater changes compared to the manually calculated FC values. The value in showing the manually calculated values too is to see if all replicates show the same patterns within groups. They are however optional <em>unless</em> you only have one comparison as you cannot create a heatmap with a single column.</p>
<p>Note that column-clustering has been turned off for this type of plot by setting <code>cluster_cols = FALSE</code> (all replicates are from the same group, clustering will not add any useful information).</p>
<div class="figure"><span style="display:block;" id="fig:expressionHeatmap"></span>
<img src="gene_expression_files/figure-html/expressionHeatmap-1.png" alt="Heatmap showing the fold changes of the Trisomic vs Disomic comparisons for both cell types. The shown genes are all shared DEGS (the 96 shown in the Venn-diagrams) but also filtered for an absolute log2(FC) value of &gt;2." width="672" />
<p class="caption">
Figure 5.3: Heatmap showing the fold changes of the Trisomic vs Disomic comparisons for both cell types. The shown genes are all shared DEGS (the 96 shown in the Venn-diagrams) but also filtered for an absolute log2(FC) value of &gt;2.
</p>
</div>
<p>A limitation of such a heatmap will show itself when more then 100 DEGs are found; this just doesn’t fit well in a single figure and causes the clustering and especially the gene names/ labels to be unreadable. It is therefore always adviced to not only filter on the adjusted p-value, but also on the log-FC value to reduce the number of genes shown. Alternatively if the data is properly annotated, instead of showing gene names for each row, showing a GO-term clustering might reveal expression patterns for certain gene groups.</p>
</div>
<div id="pathway-analysis" class="section level2 hasAnchor" number="5.4">
<h2><span class="header-section-number">5.4</span> Pathway Analysis<a href="chapter-5.html#pathway-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In some cases you’ll see hundreds or even thousands of DEGs as a result of an analysis. These large amounts of DEGs are too much for most visualization approaches or to easily say something about the biological context for that many genes.</p>
<p>One approach for tackling such a large set of DEGs is <em>pathway analysis</em> where through different methods genes are grouped by pathway to get an overview of affected pathways in the experiment.</p>
<p>This section will demonstrate two methods for this analysis, one using an online platform for <em>gene-annotation enrichment</em> analysis and an R-method for <em>signaling pathway impact analysis</em>.</p>
<div id="kegg-pathway-visualization-10-degs" class="section level3 hasAnchor" number="5.4.1">
<h3><span class="header-section-number">5.4.1</span> KEGG-pathway Visualization (&gt;10 DEGs)<a href="chapter-5.html#kegg-pathway-visualization-10-degs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Knowing the interesting KEGG-pathway(s) upfront (i.e. it is listed in the article) allows for visualizations applied to that selected pathway. For this we can use the <code>pathview</code> <a href="https://pathview.uncc.edu">website</a> or Bioconductor <a href="https://bioconductor.org/packages/release/bioc/html/pathview.html">library</a>:</p>
<blockquote>
<p>“… It maps and renders a wide variety of biological data on relevant pathway graphs. All users need is to supply their data and specify the target pathway. Pathview automatically downloads the pathway graph data, parses the data file, maps user data to the pathway, and render pathway graph with the mapped data.”</p>
</blockquote>
<p>This section demonstrates only the use of the bioconductor package for visualizing not only the DEGs onto pathways, but also the change in expression for each gene.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="chapter-5.html#cb32-1" tabindex="-1"></a><span class="do">## Bioconductor library (install with bioclite() if missing)</span></span>
<span id="cb32-2"><a href="chapter-5.html#cb32-2" tabindex="-1"></a><span class="fu">library</span>(pathview)</span>
<span id="cb32-3"><a href="chapter-5.html#cb32-3" tabindex="-1"></a></span>
<span id="cb32-4"><a href="chapter-5.html#cb32-4" tabindex="-1"></a><span class="do">## Example pathway IDs (for human, change organism key for other organisms)</span></span>
<span id="cb32-5"><a href="chapter-5.html#cb32-5" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;paths.hsa&quot;</span>)</span>
<span id="cb32-6"><a href="chapter-5.html#cb32-6" tabindex="-1"></a><span class="fu">pander</span>(<span class="fu">head</span>(paths.hsa, <span class="at">n=</span><span class="dv">5</span>))</span></code></pre></div>
<table style="width:82%;">
<colgroup>
<col width="43%" />
<col width="38%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">hsa00010</th>
<th align="center">hsa00020</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">Glycolysis / Gluconeogenesis</td>
<td align="center">Citrate cycle (TCA cycle)</td>
</tr>
</tbody>
</table>
<p>Table continues below</p>
<table>
<colgroup>
<col width="36%" />
<col width="33%" />
<col width="29%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">hsa00030</th>
<th align="center">hsa00040</th>
<th align="center">hsa00051</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">Pentose phosphate pathway</td>
<td align="center">Pentose and glucuronate
interconversions</td>
<td align="center">Fructose and mannose
metabolism</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="chapter-5.html#cb33-1" tabindex="-1"></a><span class="do">## Check &#39;gene.idtype&#39; argument possibilities</span></span>
<span id="cb33-2"><a href="chapter-5.html#cb33-2" tabindex="-1"></a><span class="fu">data</span>(gene.idtype.list); </span>
<span id="cb33-3"><a href="chapter-5.html#cb33-3" tabindex="-1"></a><span class="fu">pander</span>(gene.idtype.list)</span></code></pre></div>
<p><em>SYMBOL</em>, <em>GENENAME</em>, <em>ENSEMBL</em>, <em>ENSEMBLPROT</em>, <em>UNIGENE</em>, <em>UNIPROT</em>, <em>ACCNUM</em>, <em>ENSEMBLTRANS</em>, <em>REFSEQ</em>, <em>ENZYME</em>, <em>TAIR</em>, <em>PROSITE</em> and <em>ORF</em></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="chapter-5.html#cb34-1" tabindex="-1"></a><span class="do">## Prepare data for visualization</span></span>
<span id="cb34-2"><a href="chapter-5.html#cb34-2" tabindex="-1"></a>deseq.degs.logfc <span class="ot">&lt;-</span> <span class="fu">subset</span>(deseq.results, padj <span class="sc">&lt;</span> pval_threshold, <span class="at">select =</span> log2FoldChange)</span>
<span id="cb34-3"><a href="chapter-5.html#cb34-3" tabindex="-1"></a></span>
<span id="cb34-4"><a href="chapter-5.html#cb34-4" tabindex="-1"></a><span class="fu">pander</span>(<span class="fu">head</span>(deseq.degs.logfc))</span></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="chapter-5.html#cb35-1" tabindex="-1"></a><span class="fu">pathview</span>(<span class="at">gene.data=</span>deseq.degs.logfc,</span>
<span id="cb35-2"><a href="chapter-5.html#cb35-2" tabindex="-1"></a>         <span class="at">pathway.id=</span><span class="st">&quot;00020&quot;</span>, <span class="co"># TCA-cycle</span></span>
<span id="cb35-3"><a href="chapter-5.html#cb35-3" tabindex="-1"></a>         <span class="at">species=</span><span class="st">&quot;hsa&quot;</span>     <span class="co"># Organism key</span></span>
<span id="cb35-4"><a href="chapter-5.html#cb35-4" tabindex="-1"></a>)</span></code></pre></div>

</div>
</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="chapter-4.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="a2-data_loading.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
